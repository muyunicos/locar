<?php

if (!function_exists("render_image")) {
    function render_image($url, $alt = "", $class = "", $loading = "lazy")
    {
        if (empty($url)) {
            return;
        } ?>
<img 
    src="<?= htmlspecialchars($url) ?>" 
    alt="<?= htmlspecialchars($alt) ?>" 
    <?= !empty($class) ? 'class="' . htmlspecialchars($class) . '"' : "" ?> 
    <?= !empty($loading)
        ? 'loading="' . htmlspecialchars($loading) . '"'
        : "" ?>
/>
<?php
    }
}

if (!function_exists("render_item")) {
    function render_item($items_array)
    {
        if (empty($items_array)) {
            return;
        }

        foreach ($items_array as $item) {
            if (isset($item["hidden"]) && $item["hidden"]) {
                continue;
            }
            $has_image = !empty($item["imagen_url"]);
            if (isset($item["es_cat"]) && $item["es_cat"]) { ?>
<div class="c-container <?= isset($item["layout"])
    ? htmlspecialchars($item["layout"])
    : "" ?>">
    <h3 class="c-titulo">
        <div class="c-titulo-content">
            <span><?= htmlspecialchars($item["titulo"]) ?></span>
            <?php if (!empty($item["descripcion"])): ?>
            <small class="c-titulo-descripcion"><?= htmlspecialchars(
                $item["descripcion"]
            ) ?></small>
            <?php endif; ?>
        </div>
        <?php if ($has_image): ?>
            <?php render_image($item["imagen_url"]); ?>
        <?php endif; ?>
    </h3>

    <div class="item-list">
        <?php render_item($item["items"]); ?>
    </div>
</div>
<?php } else { ?>
<div class="item">
    <?php if ($has_image): ?>
    <div class="item-imagen-wrapper">
        <?php render_image($item["imagen_url"], $item["titulo"]); ?>
    </div>
    <?php endif; ?>

    <div class="item-details">
        <div class="item-info">
            <h3 class="item-titulo">
                <?= htmlspecialchars($item["titulo"]) ?>
            </h3>
            <?php if (!empty($item["descripcion"])): ?>
            <p class="item-descripcion">
                <?= htmlspecialchars($item["descripcion"]) ?>
            </p>
            <?php endif; ?>
        </div>
        <div class="item-precio">
            <?php if (isset($item["original_price"])): ?>
            <span class="precio-original">
                <span class="precio-simbolo">$</span>
                <span class="precio-valor"><?= htmlspecialchars(
                    number_format($item["original_price"], 0, ",", ".")
                ) ?></span>
                <span class="precio-decimales">,-</span>
            </span>
            <?php endif; ?>
            <span class="precio-final">
                <span class="precio-simbolo">$</span>
                <span class="precio-valor"><?= htmlspecialchars(
                    number_format($item["precio"], 0, ",", ".")
                ) ?></span>
                <span class="precio-decimales">,-</span>
            </span>
        </div>
    </div>
</div>
<?php }
        }
    }
}
?>

<div class="module-container module-menues">
    
    <?php if (!empty($menu_image_url)): ?>
    <div class="menu-header-image-container">
        <?php render_image($menu_image_url, $menu_title); ?>
    </div>
    <?php else: ?>
    <h2 class="menues-title"><?= htmlspecialchars($menu_title) ?></h2>
    <?php endif; ?>

    <?php if (isset($error) && !empty($error)): ?>
    <p class="app-error"><?= htmlspecialchars($error) ?></p>
    <?php else: ?>
        <div class="item-list">
        <?php render_item($items); ?>
    </div>
    <?php endif; ?>

    <?php if (!empty($footer_text)): ?>
    <footer class="menu-footer">
        <p><?= htmlspecialchars($footer_text) ?></p>
    </footer>
    <?php endif; ?>
</div>